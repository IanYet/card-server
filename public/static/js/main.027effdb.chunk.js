(this["webpackJsonpcard-manhattan"]=this["webpackJsonpcard-manhattan"]||[]).push([[0],{13:function(e,t,a){e.exports={dash:"dashBoard_dash__19ntG",cardArea:"dashBoard_cardArea__1_Nj5",chessArea:"dashBoard_chessArea__jqoS0",roundChessArea:"dashBoard_roundChessArea__2QkXr",chess:"dashBoard_chess__AXCt1",chessHolder:"dashBoard_chessHolder__1fKsh",leftChessArea:"dashBoard_leftChessArea___yuio",rowChessArea:"dashBoard_rowChessArea__2oB3z",card:"dashBoard_card__3Bty0",hoveredNext:"dashBoard_hoveredNext__1dtDG",selectedNext:"dashBoard_selectedNext__uMRXU",hovered:"dashBoard_hovered__Qb2h_",selected:"dashBoard_selected__1h8gJ",red:"dashBoard_red__5htZ_",green:"dashBoard_green__3_YAL",blue:"dashBoard_blue__3JkBp",yellow:"dashBoard_yellow__3I3q2",btnBars:"dashBoard_btnBars__NBazI",msg:"dashBoard_msg__1hn6L",btnArea:"dashBoard_btnArea___iJ27",submit:"dashBoard_submit__25qR5",pressed:"dashBoard_pressed__2KrWz",backView:"dashBoard_backView__3DUXG"}},16:function(e,t,a){e.exports={chatroom:"chatroom_chatroom__1yhX-",symbol:"chatroom_symbol__1am2s",red:"chatroom_red__162bV",spread:"chatroom_spread__3Tz5u",yellow:"chatroom_yellow__1HQhG",green:"chatroom_green__3xdpz",blue:"chatroom_blue__2bvqZ",inputContainer:"chatroom_inputContainer__3Baar",channelTitle:"chatroom_channelTitle__33wYq",input:"chatroom_input__3HwWM",popList:"chatroom_popList__3SHvF",pop:"chatroom_pop__Vk0Ea",self:"chatroom_self__3USxl",collapse:"chatroom_collapse__yFzh2"}},18:function(e,t,a){e.exports={info:"infoPanel_info__30wGd",userboard:"infoPanel_userboard__3U2_Y",pin:"infoPanel_pin__2OwTM",avatar:"infoPanel_avatar__3GWxq",red:"infoPanel_red__qHI6l",yellow:"infoPanel_yellow__dphaG",blue:"infoPanel_blue__10QMT",green:"infoPanel_green__3Cv9m",pointerContainer:"infoPanel_pointerContainer__2hRCA",long:"infoPanel_long__119oW",waiting:"infoPanel_waiting__2WYkP",infoRow:"infoPanel_infoRow__1WQs7",chess:"infoPanel_chess__ug-4Y",hide:"infoPanel_hide__35cb-",leftChess:"infoPanel_leftChess__1MZxQ"}},44:function(e,t,a){e.exports={stage:"stage_stage__BJpJC"}},49:function(e,t,a){},51:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a.n(n),o=a(28),c=a.n(o),s=(a(49),a(7)),i=a(10),l=(a(51),a(17)),d=a(21),u=a(0),h=a(1),p=a(5),f=a(43),b=0,j=1,m=0,v=1,w="city",O="area",y="building",_="grid",g="floor",x={red:"#f5e1da",yellow:"#ffe194",green:"#c9e4c5",blue:"#d0e8f2"},C={setColor:"setColor",chat:"chat",step:"step",error:"error"},D={areas:[],buildings:[],floors:[],oriViewState:{camera:{},controls:{}},mode:b,playedChess:"",playedCard:[],playedArea:"",truePos:[]},k=new p.n({color:new p.e("rgb(255,255,255)")}),I=new p.n({alphaMap:(new p.x).load("./alpha.png"),transparent:!0,depthWrite:!1}),N={red:new p.n({color:x.red}),yellow:new p.n({color:x.yellow}),green:new p.n({color:x.green}),blue:new p.n({color:x.blue})},S={red:new p.n({color:x.red,transparent:!0,opacity:.5}),yellow:new p.n({color:x.yellow,transparent:!0,opacity:.5}),green:new p.n({color:x.green,transparent:!0,opacity:.5}),blue:new p.n({color:x.blue,transparent:!0,opacity:.5})},P=new p.n({color:16777215,opacity:.8,transparent:!0,emissive:16777215,emissiveIntensity:1,side:p.g}),M=new p.m({map:function(e,t,a,n){var r=document.createElement("canvas");r.height=n,r.width=a;var o=r.getContext("2d"),c=o.createLinearGradient(0,0,0,n);return c.addColorStop(0,t),c.addColorStop(.9,e),o.fillStyle=c,o.fillRect(0,0,a,n),new p.d(r)}("#9cacd0","#e3c3cb",512,256),side:p.b});var B=function e(t,a){if(a.length){var n=a.shift(),r=500*t.userData.data.reduce((function(e,t){return e+parseInt(t)}),0);return t.userData.data.push(n),new Promise((function(e,a){var o=A(n);o.position.setZ(r+500*parseInt(n)/2),r/500%2&&(parseInt(n)%2?o.rotateX(Math.PI):t.children[t.children.length-1].rotateX(Math.PI)),D.floors.push(o),t.add(o),e()})).then((function(){return e(t,a)}))}},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v,a=[e.substr(1),parseInt(e)],n=a[0],r=a[1],o=new p.i;o.userData.type=g,o.userData.data=e;var c=new p.c(900,900,500*r),s=t===v?N[n]:S[n],i=new p.l(c,s);o.add(i);for(var l=0;l<4;l++)for(var d=0;d<r;d++){var u=new p.q(200,200),h=P,f=new p.l(u,h);switch(o.add(f),f.rotateX(Math.PI/2),f.rotateY(l%2*Math.PI/2),f.position.setZ(500*d-250*r+250),l){case 0:f.position.setX(d%2*450-225),f.position.setY(-451);break;case 1:f.position.setX(451),f.position.setY(d%2*450-225);break;case 2:f.position.setX((d+1)%2*450-225),f.position.setY(451);break;case 3:f.position.setX(-451),f.position.setY((d+1)%2*450-225)}}return o},E=a(23),T=a(9),F={disposeAll:function(e){if(e){for(;e.children.length>0;)F.disposeAll(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((function(t){e.material[t]&&null!==e.material[t]&&"function"===typeof e.material[t].dispose&&e.material[t].dispose()})),e.material.dispose())}},rotateUp:function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1],o=[[0,0],[0,2],[2,2],[2,0]],c=[[0,1],[1,2],[2,1],[1,0]],i=o.findIndex((function(e){var t=Object(s.a)(e,2),a=t[0],o=t[1];return a===n&&o===r})),l=c.findIndex((function(e){var t=Object(s.a)(e,2),a=t[0],o=t[1];return a===n&&o===r}));return-1!==l?c[(l+Number(t))%4]:-1!==i?o[(i+Number(t))%4]:e}},L=function e(t,a){return t.parent?"Group"===t.type&&t.userData.type===a?t:e(t.parent,a):null},z={raycaster:null,intersectObject:null,tempFloor:null,pointerDownTime:0,up:0,choose:function(e,t){var a,n=null===(a=z.raycaster.intersectObjects(e,!0)[0])||void 0===a?void 0:a.object;return n?L(n,t):null},handleViewModeMove:function(e){if(D.mode!==j){var t=z.choose(D.floors,g);if(z.intersectObject!==t){if(z.intersectObject)new E.a(z.intersectObject.scale).easing(E.b.Easing.Circular.In).to({x:1,y:1,z:1},150).start();if(t)new E.a(t.scale).easing(E.b.Easing.Circular.Out).to({x:1.1,y:1.1,z:1.1},150).start();z.intersectObject=t}}},handleOperModeMove:function(e){if(D.mode!==b&&z.tempFloor){var t=z.choose(D.areas,O);if(z.intersectObject!==t){var a,n,r=F.rotateUp(D.playedCard,z.up),o=Object(s.a)(r,2),c=o[0],i=o[1];if(z.intersectObject){var l=z.intersectObject.children.find((function(e){return e.userData.id==="".concat(z.intersectObject.userData.id,"-").concat(c,"-").concat(i)}));a=l,n=z.tempFloor,a.remove(n)}if(t){var d=t.children.find((function(e){return e.userData.id==="".concat(t.userData.id,"-").concat(c,"-").concat(i)}));(function(e,t){var a,n=function(e){return[e.substr(1),parseInt(e)]},r={red:0,yellow:0,blue:0,green:0,max:0},o=Object(T.a)(e);try{for(o.s();!(a=o.n()).done;){var c=n(a.value),i=Object(s.a)(c,2),l=i[0],d=i[1];r[l]+=d,r[l]>=r.max&&(r.max=r[l])}}catch(b){o.e(b)}finally{o.f()}var u=n(t),h=Object(s.a)(u,2),p=h[0],f=h[1];return r[p]+f>=r.max})(d.userData.data,z.tempFloor.userData.data)&&function(e,t){var a=500*e.userData.data.reduce((function(e,t){return e+parseInt(t)}),0),n=t.userData.data;e.add(t),t.position.setZ(a+500*parseInt(n)/2),t.rotateX(a/500%2*Math.PI)}(d,z.tempFloor)}z.intersectObject=t}}},handlePointerUp:function(e){if(!(e.timeStamp-z.pointerDownTime>=120))if(0===e.button){if(D.mode===b)return;z.intersectObject&&(D.playedArea=z.intersectObject.userData.id,D.truePos=F.rotateUp(D.playedCard,z.up),R.changeMode(b))}else 2===e.button&&R.changeMode(j)},handlePointerDown:function(e){z.pointerDownTime=e.timeStamp},createTempFloor:function(){var e;if((null===(e=D.playedCard)||void 0===e?void 0:e.length)||D.playedChess){z.disposeTempFloor();var t=D.playedChess,a=A(t,m);this.tempFloor=a}},disposeTempFloor:function(){z.tempFloor&&(z.tempFloor.parent&&z.tempFloor.parent.remove(z.tempFloor),F.disposeAll(z.tempFloor))},start:function(e,t){z.raycaster=t,e.addEventListener("pointermove",z.handleViewModeMove),e.addEventListener("pointermove",z.handleOperModeMove),e.addEventListener("pointerdown",this.handlePointerDown),e.addEventListener("pointerup",this.handlePointerUp)},play:function(e,t,a,n){var r=[e],o=F.rotateUp(t,n),c=Object(s.a)(o,2),i=c[0],l=c[1],d=D.buildings.find((function(e){return e.userData.id==="".concat(a,"-").concat(i,"-").concat(l)}));B(d,r)},reset:function(){z.pointerDownTime=0,z.intersectObject=null}},R=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"init",value:function(e){this.renderer=this.initRenderer(e),this.camera=this.initCamera(),this.secondViewCamera=this.initSecondViewCamera(),this.scene=this.initScene(),this.controls=this.initControls(),this.mouse=new p.y,this.raycaster=this.initRaycaster(),this.mode=b,this.initLights(),this.initEvents(),this.initSky(),this.update()}},{key:"initRenderer",value:function(e){var t=document.createElement("canvas");t.style.height="100vh",t.style.width="100vw",e.appendChild(t);var a=new p.A({canvas:t,antialias:!0,autoClear:!1});return a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),a}},{key:"initCamera",value:function(){var e=new p.p(75,window.innerWidth/window.innerHeight,100,1e6);return window.camera=e,e.up.copy(new p.z(0,0,1)),e.position.setY(-11e3),e.position.setZ(2e3),D.oriViewState.camera={position:(new p.z).copy(e.position),up:new p.z(0,0,1)},e}},{key:"initSecondViewCamera",value:function(){var e=new p.o(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,10,1e6);return e.up.copy(new p.z(0,0,1)),e.position.copy(new p.z(-2e3,0,500)),e.lookAt(new p.z(0,0,0)),e.zoom=.1,e}},{key:"initScene",value:function(){var e=new p.t;return e.background=new p.e("rgb(31,50,104)"),e}},{key:"initControls",value:function(){var e=new f.a(this.camera,this.renderer.domElement);return e.screenSpacePanning=!1,e.enableDamping=!0,e.dampingFactor=.1,e.maxPolarAngle=Math.PI/2,e.target.set(0,0,2e3),D.oriViewState.controls={target:(new p.z).copy(e.target)},e}},{key:"initLights",value:function(){var e=new p.j(new p.e(16242646),new p.e(10923984),.9);e.position.set(0,0,1),this.scene.add(e);var t=new p.f(new p.e(16777215),.25);t.position.copy(new p.z(1,-2,2)),this.scene.add(t);var a=new p.f(new p.e(14935011),.15);a.position.copy(new p.z(-1,2,0)),this.scene.add(a)}},{key:"initSky",value:function(){var e=new p.u(2e4,64,64),t=M,a=new p.l(e,t);a.rotateX(Math.PI/2),this.scene.add(a)}},{key:"initEvents",value:function(){var e=this;window.onresize=function(t){e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.secondViewCamera.left=window.innerWidth/-2,e.secondViewCamera.right=window.innerWidth/2,e.secondViewCamera.top=window.innerHeight/-2,e.secondViewCamera.bottom=window.innerHeight/2,e.renderer.setSize(window.innerWidth,window.innerHeight)},window.onpointermove=function(t){e.mouse.x=t.clientX/window.innerWidth*2-1,e.mouse.y=-t.clientY/window.innerHeight*2+1}}},{key:"initRaycaster",value:function(){var e=new p.s;return e.setFromCamera(this.mouse,this.camera),e}},{key:"setOpt",value:function(e){}},{key:"update",value:function(){var e=this;requestAnimationFrame((function(){return e.update()})),E.b.update(),this.controls.update(),this.raycaster.setFromCamera(this.mouse,this.camera),this.renderer.render(this.scene,this.camera)}},{key:"drawBoard",value:function(e,t){!function(e,t,a){var n=new p.i;n.userData.type=w,e.add(n);var r=new p.a(1e4);n.add(r),window.axesHelper=r;for(var o=0,c=Object.keys(a);o<c.length;o++){var s=c[o],i=a[s],d=new p.i;d.userData.id=s,d.userData.type=O;var u=parseInt(s.replace("area",""));d.position.setX(u%3*3600-3600),d.position.setY(1800-3600*parseInt(u/3)),d.position.setZ(0),d.rotateZ(t/4*Math.PI*2),n.add(d),D.areas.push(d);for(var h=0;h<3;h++)for(var f=0;f<3;f++){var b=Object(l.a)(i[h][f]),j=new p.i;j.userData.id="".concat(s,"-").concat(h,"-").concat(f),j.userData.data=[],j.userData.type=y,d.add(j),D.buildings.push(j);var m=new p.z(1100*f-1100,1100-1100*h,0);j.position.copy(m);var v=new p.i;v.userData.type=_,j.add(v),v.position.setZ(-550);var g=new p.l(new p.q(1e3,1e3),k);g.position.setZ(450),v.add(g);var x=new p.l(new p.q(1e3,1e3),I);x.position.set(0,-500,-50),x.rotateZ(Math.PI),x.rotateX(-Math.PI/2),v.add(x);var C=x.clone();C.position.setY(500),C.rotateY(Math.PI),v.add(C);var N=x.clone();N.position.setY(0),N.position.setX(-500),N.rotateY(Math.PI/2),v.add(N);var S=N.clone();S.position.setX(500),S.rotateY(Math.PI),v.add(S);var P=new p.c(900,900,100),M=new p.l(P,k);v.add(M),M.position.setZ(500),B(j,b)}}}(this.scene,e,t)}},{key:"resetViewState",value:function(){this.camera.position.copy(D.oriViewState.camera.position),this.camera.up.copy(D.oriViewState.camera.up),this.controls.target.copy(D.oriViewState.controls.target)}}],[{key:"changeMode",value:function(e){this.mode=e,D.mode=this.mode,z.reset()}}]),e}(),V=new R;var H="pre_round",W="round_end",X={up:0,userId:"",color:"",step:H,cityData:{},cardData:[],chessData:[],userList:[],leftChessData:{1:11,2:6,3:4,4:3},playedData:{}},Y=Object(i.b)({key:"msgListStom",default:[]}),J=Object(i.b)({key:"played-data-atom",default:X.playedData}),Z=a(14),U=a.n(Z),q=a(20),G=a(27),K=a.n(G),Q={url:"",key:"",id:"",ws:null,setUrl:function(e){return Q.url=e},setKey:function(e){return Q.key=e},setId:function(e){return Q.id=e},getInitData:function(){var e=Object(q.a)(U.a.mark((function e(){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.a.get("".concat(Q.url).concat(Q.key,"/data?userId=").concat(Q.id)).then((function(e){X.cityData=e.data.cityData,X.cardData=e.data.cardData,X.chessData=e.data.chessData,X.up=e.data.up,X.color=e.data.color,X.userId=e.data.userId,X.leftChessData=e.data.leftChessData,X.playedData=e.data.playedData,X.userList=e.data.users.sort((function(e,t){return e.up-t.up})),z.up=X.up})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setWs:function(e){var t=new WebSocket(e);Q.ws=t,t.onopen=function(){t.send(JSON.stringify({type:C.setColor,roomKey:Q.key,payload:{userId:X.userId}}))};var a=t.onmessage;t.onmessage=function(e){console.log("net.js 44"),a&&a(e),console.log(JSON.parse(e.data))}},postRoundChess:function(){var e=Object(q.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.a.post("".concat(Q.url).concat(Q.key,"/postRoundChess"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),play:function(){var e=Object(q.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.a.post("".concat(Q.url).concat(Q.key,"/play"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),postScore:function(){var e=Object(q.a)(U.a.mark((function e(t){return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.a.post("".concat(Q.url).concat(Q.key,"/score"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},$=a(16),ee=a.n($),te=a(6);function ae(){var e=Object(d.useState)(!1),t=Object(s.a)(e,2),a=t[0],n=t[1],r=Object(d.useState)(""),o=Object(s.a)(r,2),c=o[0],u=o[1],h=Object(i.d)(Y),p=Object(s.a)(h,2),f=p[0],b=p[1],j=Object(i.e)(J),m=Object(d.useState)(!0),v=Object(s.a)(m,2),w=v[0],O=v[1],y=Object(d.useRef)(null);return Object(d.useEffect)((function(){var e=Q.ws.onmessage;Q.ws.onmessage=function(t){e(t);var a=JSON.parse(t.data),n=a.type,r=a.payload;n===C.chat&&(b((function(e){return[].concat(Object(l.a)(e),[{color:r.color,value:r.message}])})),u(""))}}),[b]),Object(d.useEffect)((function(){y.current.scrollTop=y.current.scrollHeight}),[f,y]),Object(te.jsxs)("div",{className:"".concat(ee.a.chatroom," ").concat(ee.a[X.color]),children:[Object(te.jsx)("div",{className:"".concat(ee.a.symbol," ").concat(a?ee.a.spread:""),onClick:function(e){return n(!a)},children:"\ue901"}),Object(te.jsxs)("div",{children:[Object(te.jsx)("div",{className:"".concat(ee.a.popList),ref:y,children:w?f.map((function(e,t){return Object(te.jsx)("div",{className:"".concat(ee.a.pop," ").concat(ee.a[e.color]," ").concat(e.color===X.color?ee.a.self:""," ").concat(a?"":ee.a.collapse),children:e.value},e.value+t)})):j.map((function(e,t){return Object(te.jsx)("div",{className:"".concat(ee.a.pop," ").concat(ee.a[e.color]," ").concat(e.color===X.color?ee.a.self:""," ").concat(a?"":ee.a.collapse),children:"".concat(e.floor).concat(e.card).concat(e.area)},t+e.floor)}))}),Object(te.jsxs)("div",{className:"".concat(ee.a.inputContainer,"   ").concat(a?"":ee.a.collapse),children:[Object(te.jsx)("div",{className:"".concat(ee.a.channelTitle),children:w?"\u804a\u5929":"\u8bb0\u5f55"}),Object(te.jsx)("input",{className:"".concat(ee.a.input),onChange:function(e){w&&u(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&w&&""!==c?Q.ws.send(JSON.stringify({type:C.chat,roomKey:Q.key,payload:{userId:X.userId,message:c}})):"Tab"===e.key&&(e.preventDefault(),O(!w))},value:c,placeholder:"\u6309tab\u5207\u6362\u9891\u9053"})]})]})]})}var ne=a(12),re=a(11),oe=a(13),ce=a.n(oe);function se(e,t,a,n,r,o,c){e.beginPath(),e.moveTo(t,a+o),e.lineTo(t,a+r-o),e.arc(t+o,a-o+r,o,Math.PI,Math.PI/2,!0),e.lineTo(t+n-o,a+r),e.arc(t-o+n,a-o+r,o,Math.PI/2,0,!0),e.lineTo(t+n,a+o),e.arc(t-o+n,a+o,o,0,-Math.PI/2,!0),e.lineTo(t+o,a),e.arc(t+o,a+o,o,-Math.PI/2,-Math.PI,!0),e.stroke(),c&&(e.fillStyle="rgba(255,255,255,1)",e.fill())}function ie(e){var t=e.idx,a=e.color,r=e.data,o=e.selectedCard,c=e.setSelectedCard,s=e.hoveredCard,l=e.setHoveredCard,d=Object(n.useRef)(null),u=Object(i.e)(xe),h=Object(n.useRef)({green:["#aac9ce","#f3dbcd",x.green],blue:["#c9bbcb","#aac9ce",x.blue],red:["#e5c1cd","#f3dbcf",x.red],yellow:["#f3dbcf","#c9bbcb",x.yellow]});return Object(n.useEffect)((function(){var e=d.current.getContext("2d"),t=e.createLinearGradient(0,0,192,192);t.addColorStop(0,h.current[a][0]),t.addColorStop(1,h.current[a][1]),e.fillStyle=t,e.fillRect(0,0,192,192),e.lineWidth=4,e.strokeStyle="rgba(255,255,255,1)";for(var n=0;n<3;n++)for(var o=0;o<3;o++){var c=!1;r[0]===n&&r[1]===o&&(c=!0),se(e,44*o+15*(o+1),44*n+15*(n+1),44,44,8,c)}}),[a,r]),Object(te.jsx)("canvas",{className:"".concat(ce.a.card," ").concat(t===o?ce.a.selected:""," ").concat(t===o+1?ce.a.selectedNext:""," ").concat(t===s?ce.a.hovered:""," ").concat(t===s+1?ce.a.hoveredNext:""),width:192,height:192,style:{left:100*t+"px",borderColor:t===o?h.current[a][2]:"rgba(255,255,255,1)"},onClick:function(e){u.replace("_turn","")===X.color&&c(t===o?-2:t)},onPointerEnter:function(e){return l(t)},onPointerLeave:function(e){return l(-2)},ref:d})}var le=Object(i.b)({key:"_card-data",default:Object(l.a)(X.cardData)}),de=Object(i.c)({key:"card-data",get:function(e){return(0,e.get)(le)},set:function(e){var t=e.set,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(l.a)(X.cardData);X.cardData=a,t(le,a)}}),ue=Object(i.b)({key:"_round-chess-data",default:Object(l.a)(X.chessData)}),he=Object(i.c)({key:"round-chess-data",get:function(e){return(0,e.get)(ue)},set:function(e){var t=e.set,a=(e.get,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(l.a)(X.chessData));X.chessData=a,t(ue,a)}}),pe=Object(i.b)({default:X.leftChessData,key:"_left-chess-data"}),fe=Object(i.b)({default:"",key:"temp-msg-atom"});function be(){var e,t=Object(i.d)(de),a=Object(s.a)(t,2),r=a[0],o=a[1],c=Object(i.d)(he),d=Object(s.a)(c,2),u=d[0],h=d[1],p=Object(i.d)(pe),f=Object(s.a)(p,2),b=f[0],m=f[1],v=Object(n.useState)(-2),w=Object(s.a)(v,2),O=w[0],y=w[1],_=Object(n.useState)(-2),g=Object(s.a)(_,2),x=g[0],C=g[1],k=Object(n.useState)(-2),I=Object(s.a)(k,2),N=I[0],S=I[1],P=Object(n.useState)([]),M=Object(s.a)(P,2),B=M[0],A=M[1],E=Object(n.useState)(!1),T=Object(s.a)(E,2),F=T[0],L=T[1],V=Object(i.d)(fe),Y=Object(s.a)(V,2),J=Y[0],Z=Y[1],U=Object(i.e)(ge),q=Object(i.e)(xe),G=3===Object.keys(X.userList).length?4:6;Object(n.useEffect)((function(){U&&(o(Object(l.a)(X.cardData)),h(Object(l.a)(X.chessData)))}),[U,o,h]),Object(n.useEffect)((function(){u.length&&q!==H&&X.color===q.replace("_turn","")&&(D.playedChess=u[N]+X.color,z.createTempFloor(),R.changeMode(j))}),[N,u,q]),Object(n.useEffect)((function(){r.length&&q!==H&&X.color===q.replace("_turn","")&&(D.playedCard=r[O],z.createTempFloor(),R.changeMode(j))}),[O,r,q]),Object(n.useEffect)((function(){var e="\u8bf7\u9009\u62e9\u672c\u9636\u6bb5\u6e38\u620f\u4f60\u6240\u9009\u7528\u7684\u68cb\u5b50",t="\u4f60\u7684\u56de\u5408\uff0c\u8bf7\u6446\u653e\u5efa\u7b51",a="\u73b0\u5728\u662f\u5176\u4ed6\u4eba\u7684\u56de\u5408",n="\u672c\u9636\u6bb5\u7ed3\u675f\uff0c\u4f60\u7684\u5206\u6570\u662f\uff1a";console.log(q),q===H?Z(e):q.includes("turn")?X.color===q.replace("_turn","")?setTimeout((function(){y(0),S(0),Z(t),L(!1)}),100):setTimeout((function(){Z(a)}),100):q===W&&Z(n)}),[q,Z]);var K=(e={},Object(ne.a)(e,H,Object(te.jsx)("div",{className:"".concat(ce.a.submit," ").concat(ce.a[X.color]," ").concat(F?ce.a.pressed:""),onClick:function(){if(!F)if(B.length<G)Z("\u8bf7\u9009\u62e9"+G+"\u4e2a\u68cb\u5b50");else{L(!0);var e=B.map((function(e){return parseInt(e)})).sort(),t={1:0,2:0,3:0,4:0},a=Object(re.a)({},X.leftChessData);e.forEach((function(e){return t[e]+=1}));for(var n=1;n<5;n++)a[n]=a[n]-t[n];var r={userId:X.userId,roundChess:e,leftChess:a};Q.postRoundChess(r).then((function(){h(e),X.leftChessData=Object(re.a)({},a),m(X.leftChessData),A([]),Z("\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u73a9\u5bb6"),console.log(X)})).catch((function(){Z("\u7f51\u7edc\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5"),setTimeout((function(){Z("")}),3e3),L(!1)}))}},children:"\u7ed3\u675f\u51c6\u5907"})),Object(ne.a)(e,"your",Object(te.jsx)("div",{className:"".concat(ce.a.submit," ").concat(ce.a[X.color]," ").concat(F?ce.a.pressed:""),onClick:function(e){F||function(){var e=u[N]+X.color,t=r[O],a=D.playedArea;if(""===a){var n=J;return Z("\u8bf7\u9009\u62e9\u57ce\u533a"),void setTimeout((function(){Z(n)}),3e3)}var c=Object(s.a)(D.truePos,2),i=c[0],l=c[1],d=JSON.parse(JSON.stringify(X.cityData));d[a][i][l].push(e);var p=X.cardData.filter((function(e,t){return t!==O})),f=X.chessData.filter((function(e,t){return t!==N})),b={userId:X.userId,floor:e,card:t,area:a,leftCard:p,roundChess:f,cityData:d};Q.play(b).then((function(e){var t=e.data;z.disposeTempFloor(),o(t),h(f),y(-2),S(-2)}))}()},children:"\u7ed3\u675f\u56de\u5408"})),Object(ne.a)(e,"other",""),e),$=[0,1,2,3,4,5].map((function(e){return Object(te.jsx)("div",{className:"".concat(ce.a.chess," ").concat(ce.a[X.color]," ").concat(e===N?ce.a.selected:""),onClick:function(t){q.replace("_turn","")===X.color&&u[e]&&S(e)},children:u[e]?Object(te.jsx)("img",{src:"./floor".concat(u[e],".svg"),alt:"floor".concat(u[e])}):Object(te.jsx)("div",{className:"".concat(ce.a.chessHolder)})},e)})),ee=function(e){return new Array(b[e]).fill().map((function(t,a){return Object(te.jsx)("div",{className:"".concat(ce.a.chess,"  ").concat(ce.a[X.color]," ").concat(B.includes("".concat(e,"-").concat(a))?ce.a.selected:""),onClick:function(t){if(q===H&&!F)if(B.includes("".concat(e,"-").concat(a)))A(B.filter((function(t){return t!=="".concat(e,"-").concat(a)})));else{if(B.length>=G)return;A([].concat(Object(l.a)(B),["".concat(e,"-").concat(a)]))}},style:{marginLeft:a%6===0?"":".4rem",marginBottom:".4rem"},children:Object(te.jsx)("img",{src:"./floor".concat(e,".svg"),alt:"floor".concat(e)})},a)}))},ae=Object.keys(b).sort().map((function(e){return Object(te.jsx)("div",{className:"".concat(ce.a.rowChessArea),children:ee(e)},e)}));return Object(te.jsxs)(te.Fragment,{children:[Object(te.jsxs)("div",{className:"".concat(ce.a.btnBars),children:[Object(te.jsxs)("div",{className:"".concat(ce.a.msg),children:[Object(te.jsx)("div",{children:J}),Object(te.jsx)("div",{className:"".concat(ce.a.backView," ").concat(ce.a[X.color]),children:"\ue900"})]}),Object(te.jsx)("div",{className:"".concat(ce.a.btnArea),children:K[q]||(q.replace("_turn","")===X.color?K.your:K.other)})]}),Object(te.jsxs)("div",{className:"".concat(ce.a.dash),children:[Object(te.jsx)("div",{className:"".concat(ce.a.cardArea),children:r.map((function(e,t){return Object(te.jsx)(ie,{idx:t,data:e,color:X.color,selectedCard:O,hoveredCard:x,setSelectedCard:y,setHoveredCard:C},"".concat(t,"-").concat(e))}))}),Object(te.jsxs)("div",{className:"".concat(ce.a.chessArea),children:[Object(te.jsx)("div",{className:"".concat(ce.a.roundChessArea),children:$}),Object(te.jsx)("div",{className:"".concat(ce.a.leftChessArea),children:ae})]})]})]})}var je=Object(i.b)({default:X.userList,key:"user-info-atom"}),me=a(18),ve=a.n(me);function we(){var e=Object(i.e)(je),t=Object(i.e)(xe),a=Object(d.useState)({}),n=Object(s.a)(a,2),r=n[0],o=n[1];Object(d.useEffect)((function(){console.log(e)}),[e]),Object(d.useEffect)((function(){if(console.log("info.js 18"),t===W){var e=function(e){console.log(e);var t={red:0,blue:0,green:0,yellow:0},a={height:0,color:""};return Object.keys(e).forEach((function(n){for(var r=e[n],o={red:0,blue:0,green:0,yellow:0},c=function(e){for(var n=function(n){var c="",s=0;if(r[e][n].forEach((function(t,a){var o=[parseInt(t),t.substr(1)],i=o[1];s+=o[0],a===r[e][n].length-1&&(c=i)})),!c)return"continue";s>a.height?(a.height=s,a.color=c):s===a.height&&(a.color=""),o[c]+=1,t[c]+=1},c=0;c<3;++c)n(c)},s=0;s<3;++s)c(s);var i={color:"",num:0};for(var l in o)o[l]>i.num?(i.color=l,i.num=o[l]):o[l]===i.num&&(i.color="");i.color&&(t[i.color]+=3)})),a.color&&(t[a.color]+=5),t}(X.cityData);Q.postScore({userId:X.userId,score:e[X.color]}).then((function(){console.log("ok")})),console.log(e)}}),[t]);return Object(te.jsx)("div",{className:"".concat(ve.a.info),children:e.map((function(e){return Object(te.jsxs)("div",{className:"".concat(ve.a[e.color]," ").concat(ve.a.userboard),onClick:(a=e.color,function(e){var t=Object(re.a)({},r);t[a]=!t[a],o(t)}),children:[Object(te.jsxs)("div",{className:"".concat(ve.a.pin),children:[Object(te.jsx)("div",{className:"".concat(ve.a.avatar),children:t.replace("_turn","")===e.color?Object(te.jsxs)(te.Fragment,{children:[Object(te.jsx)("div",{className:"".concat(ve.a.pointerContainer," ").concat(ve.a.long)}),Object(te.jsx)("div",{className:"".concat(ve.a.pointerContainer)})]}):null}),Object(te.jsx)("div",{className:"".concat(ve.a.infoRow),children:"\u4f4d\u7f6e\uff1a".concat(e.up," \u5f97\u5206\uff1a").concat(e.score)})]}),Object(te.jsx)("div",{className:"".concat(ve.a.chess," ").concat(r[e.color]?"":ve.a.hide),children:e.chessData.map((function(e,t){return Object(te.jsx)("img",{src:"./floor".concat(e,".svg"),alt:"floor".concat(e)},t)}))}),Object(te.jsx)("div",{className:"".concat(ve.a.chess," ").concat(r[e.color]?"":ve.a.hide),children:Object.keys(e.leftChessData).sort().map((function(t){return Object(te.jsxs)("div",{className:"".concat(ve.a.leftChess),children:[Object(te.jsx)("img",{src:"./floor".concat(t,".svg"),alt:"floor".concat(t)}),Object(te.jsx)("div",{children:e.leftChessData[t]})]},t)}))})]},e.color);var a}))})}var Oe=a(44),ye=a.n(Oe);function _e(){var e=Object(n.useRef)(null),t=Object(i.e)(xe),a=Object(i.f)(J),r=Object(i.f)(je);return Object(n.useEffect)((function(){var t,n,o;t=e.current,n=X.up,o=X.cityData,V.init(t),V.drawBoard(n,o),z.start(t,V.raycaster);var c=Q.ws.onmessage;Q.ws.onmessage=function(e){console.log("stage.js 20"),c&&c(e);var t=JSON.parse(e.data),n=t.type,o=t.payload;if(n===C.step){if(o.playedData&&(a(o.playedData),X.playedData=o.playedData),o.play){var s=o.play,i=s.floor,l=s.card,d=s.area,u=s.up;z.play(i,l,d,u)}o.cityData&&(X.cityData=o.cityData),o.users&&(X.userList=X.userList.map((function(e,t){var a=o.users.find((function(t){return t.color===e.color}));return Object(re.a)(Object(re.a)({},e),a)})),r(X.userList))}}}),[a,r]),Object(n.useEffect)((function(){t.replace("_turn","")===X.color?R.changeMode(j):R.changeMode(b)}),[t]),Object(te.jsx)("div",{ref:e,className:"".concat(ye.a.stage)})}var ge=Object(i.b)({default:!1,key:"ready-atom"}),xe=Object(i.b)({key:"step-atom",default:X.step});var Ce=function(){var e=Object(i.d)(ge),t=Object(s.a)(e,2),a=t[0],r=t[1],o=Object(i.f)(xe),c=Object(i.f)(fe),l=Object(i.f)(J),d=Object(i.f)(je),u=Object(i.f)(pe);return Object(n.useEffect)((function(){var e=window.location.pathname.split("/")[1],t=window.location.search.split("=")[1];Q.setUrl("http://192.168.0.37:9000/"),Q.setKey(e),Q.setId(t),Q.getInitData().then((function(){r(!0),Q.setWs("ws://192.168.0.37:9000/"),l(X.playedData),d(X.userList),u(X.leftChessData)})).then((function(e){var t=Q.ws.onmessage;Q.ws.onmessage=function(e){console.log("app.js 42"),t(e);var a=JSON.parse(e.data),n=a.type,r=a.payload;n===C.step&&(o(r.step),X.step=r.step)}}))}),[r,o,c,d,l,u]),Object(te.jsx)("div",{className:"App",children:a?Object(te.jsxs)(te.Fragment,{children:[Object(te.jsx)(ae,{}),Object(te.jsx)(be,{}),Object(te.jsx)(we,{}),Object(te.jsx)(_e,{})]}):null})};c.a.render(Object(te.jsx)(r.a.StrictMode,{children:Object(te.jsx)(i.a,{children:Object(te.jsx)(Ce,{})})}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.027effdb.chunk.js.map