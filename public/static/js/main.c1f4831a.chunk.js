(this["webpackJsonpcard-manhattan"]=this["webpackJsonpcard-manhattan"]||[]).push([[0],{13:function(e,t,a){e.exports={dash:"dashBoard_dash__19ntG",cardArea:"dashBoard_cardArea__1_Nj5",chessArea:"dashBoard_chessArea__jqoS0",roundChessArea:"dashBoard_roundChessArea__2QkXr",chess:"dashBoard_chess__AXCt1",chessHolder:"dashBoard_chessHolder__1fKsh",leftChessArea:"dashBoard_leftChessArea___yuio",rowChessArea:"dashBoard_rowChessArea__2oB3z",card:"dashBoard_card__3Bty0",hoveredNext:"dashBoard_hoveredNext__1dtDG",selectedNext:"dashBoard_selectedNext__uMRXU",hovered:"dashBoard_hovered__Qb2h_",selected:"dashBoard_selected__1h8gJ",red:"dashBoard_red__5htZ_",green:"dashBoard_green__3_YAL",blue:"dashBoard_blue__3JkBp",yellow:"dashBoard_yellow__3I3q2",btnBars:"dashBoard_btnBars__NBazI",msg:"dashBoard_msg__1hn6L",btnArea:"dashBoard_btnArea___iJ27",submit:"dashBoard_submit__25qR5",pressed:"dashBoard_pressed__2KrWz",backView:"dashBoard_backView__3DUXG"}},16:function(e,t,a){e.exports={chatroom:"chatroom_chatroom__1yhX-",symbol:"chatroom_symbol__1am2s",red:"chatroom_red__162bV",spread:"chatroom_spread__3Tz5u",yellow:"chatroom_yellow__1HQhG",green:"chatroom_green__3xdpz",blue:"chatroom_blue__2bvqZ",inputContainer:"chatroom_inputContainer__3Baar",channelTitle:"chatroom_channelTitle__33wYq",input:"chatroom_input__3HwWM",popList:"chatroom_popList__3SHvF",pop:"chatroom_pop__Vk0Ea",self:"chatroom_self__3USxl",collapse:"chatroom_collapse__yFzh2"}},18:function(e,t,a){e.exports={info:"infoPanel_info__30wGd",userboard:"infoPanel_userboard__3U2_Y",pin:"infoPanel_pin__2OwTM",avatar:"infoPanel_avatar__3GWxq",red:"infoPanel_red__qHI6l",yellow:"infoPanel_yellow__dphaG",blue:"infoPanel_blue__10QMT",green:"infoPanel_green__3Cv9m",pointerContainer:"infoPanel_pointerContainer__2hRCA",long:"infoPanel_long__119oW",waiting:"infoPanel_waiting__2WYkP",infoRow:"infoPanel_infoRow__1WQs7",chess:"infoPanel_chess__ug-4Y",hide:"infoPanel_hide__35cb-",leftChess:"infoPanel_leftChess__1MZxQ"}},43:function(e,t,a){e.exports={stage:"stage_stage__BJpJC"}},48:function(e,t,a){},50:function(e,t,a){},69:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a.n(n),o=a(27),c=a.n(o),s=(a(48),a(7)),i=a(10),l=(a(50),a(17)),d=a(0),u=a(1),h=a(5),p=a(42),f=0,b=1,j=0,m=1,v="city",w="area",O="building",y="grid",_="floor",g={red:"#f5e1da",yellow:"#ffe194",green:"#c9e4c5",blue:"#d0e8f2"},x={setColor:"setColor",chat:"chat",step:"step",error:"error"},C={areas:[],buildings:[],floors:[],oriViewState:{camera:{},controls:{}},mode:f,playedChess:"",playedCard:[],playedArea:"",truePos:[]},D=new h.n({color:new h.e("rgb(255,255,255)")}),k=new h.n({alphaMap:(new h.x).load("./alpha.png"),transparent:!0,depthWrite:!1}),I={red:new h.n({color:g.red}),yellow:new h.n({color:g.yellow}),green:new h.n({color:g.green}),blue:new h.n({color:g.blue})},N={red:new h.n({color:g.red,transparent:!0,opacity:.5}),yellow:new h.n({color:g.yellow,transparent:!0,opacity:.5}),green:new h.n({color:g.green,transparent:!0,opacity:.5}),blue:new h.n({color:g.blue,transparent:!0,opacity:.5})},S=new h.n({color:16777215,opacity:.8,transparent:!0,emissive:16777215,emissiveIntensity:1,side:h.g}),P=new h.m({map:function(e,t,a,n){var r=document.createElement("canvas");r.height=n,r.width=a;var o=r.getContext("2d"),c=o.createLinearGradient(0,0,0,n);return c.addColorStop(0,t),c.addColorStop(.9,e),o.fillStyle=c,o.fillRect(0,0,a,n),new h.d(r)}("#9cacd0","#e3c3cb",512,256),side:h.b});var M=function e(t,a){if(a.length){var n=a.shift(),r=500*t.userData.data.reduce((function(e,t){return e+parseInt(t)}),0);return t.userData.data.push(n),new Promise((function(e,a){var o=B(n);o.position.setZ(r+500*parseInt(n)/2),r/500%2&&(parseInt(n)%2?o.rotateX(Math.PI):t.children[t.children.length-1].rotateX(Math.PI)),C.floors.push(o),t.add(o),e()})).then((function(){return e(t,a)}))}},B=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,a=[e.substr(1),parseInt(e)],n=a[0],r=a[1],o=new h.i;o.userData.type=_,o.userData.data=e;var c=new h.c(900,900,500*r),s=t===m?I[n]:N[n],i=new h.l(c,s);o.add(i);for(var l=0;l<4;l++)for(var d=0;d<r;d++){var u=new h.q(200,200),p=S,f=new h.l(u,p);switch(o.add(f),f.rotateX(Math.PI/2),f.rotateY(l%2*Math.PI/2),f.position.setZ(500*d-250*r+250),l){case 0:f.position.setX(d%2*450-225),f.position.setY(-451);break;case 1:f.position.setX(451),f.position.setY(d%2*450-225);break;case 2:f.position.setX((d+1)%2*450-225),f.position.setY(451);break;case 3:f.position.setX(-451),f.position.setY((d+1)%2*450-225)}}return o},A=a(22),E=a(9),T={disposeAll:function(e){if(e){for(;e.children.length>0;)T.disposeAll(e.children[0]),e.remove(e.children[0]);e.geometry&&e.geometry.dispose(),e.material&&(Object.keys(e.material).forEach((function(t){e.material[t]&&null!==e.material[t]&&"function"===typeof e.material[t].dispose&&e.material[t].dispose()})),e.material.dispose())}},rotateUp:function(e,t){var a=Object(s.a)(e,2),n=a[0],r=a[1],o=[[0,0],[0,2],[2,2],[2,0]],c=[[0,1],[1,2],[2,1],[1,0]],i=o.findIndex((function(e){var t=Object(s.a)(e,2),a=t[0],o=t[1];return a===n&&o===r})),l=c.findIndex((function(e){var t=Object(s.a)(e,2),a=t[0],o=t[1];return a===n&&o===r}));return-1!==l?c[(l+Number(t))%4]:-1!==i?o[(i+Number(t))%4]:e}},F=function e(t,a){return t.parent?"Group"===t.type&&t.userData.type===a?t:e(t.parent,a):null},L={raycaster:null,intersectObject:null,tempFloor:null,pointerDownTime:0,up:0,choose:function(e,t){var a,n=null===(a=L.raycaster.intersectObjects(e,!0)[0])||void 0===a?void 0:a.object;return n?F(n,t):null},handleViewModeMove:function(e){if(C.mode!==b){var t=L.choose(C.floors,_);if(L.intersectObject!==t){if(L.intersectObject)new A.a(L.intersectObject.scale).easing(A.b.Easing.Circular.In).to({x:1,y:1,z:1},150).start();if(t)new A.a(t.scale).easing(A.b.Easing.Circular.Out).to({x:1.1,y:1.1,z:1.1},150).start();L.intersectObject=t}}},handleOperModeMove:function(e){if(C.mode!==f&&L.tempFloor){var t=L.choose(C.areas,w);if(L.intersectObject!==t){var a,n,r=T.rotateUp(C.playedCard,L.up),o=Object(s.a)(r,2),c=o[0],i=o[1];if(L.intersectObject){var l=L.intersectObject.children.find((function(e){return e.userData.id==="".concat(L.intersectObject.userData.id,"-").concat(c,"-").concat(i)}));a=l,n=L.tempFloor,a.remove(n)}if(t){var d=t.children.find((function(e){return e.userData.id==="".concat(t.userData.id,"-").concat(c,"-").concat(i)}));(function(e,t){var a,n=function(e){return[e.substr(1),parseInt(e)]},r={red:0,yellow:0,blue:0,green:0,max:0},o=Object(E.a)(e);try{for(o.s();!(a=o.n()).done;){var c=n(a.value),i=Object(s.a)(c,2),l=i[0],d=i[1];r[l]+=d,r[l]>=r.max&&(r.max=r[l])}}catch(b){o.e(b)}finally{o.f()}var u=n(t),h=Object(s.a)(u,2),p=h[0],f=h[1];return r[p]+f>=r.max})(d.userData.data,L.tempFloor.userData.data)&&function(e,t){var a=500*e.userData.data.reduce((function(e,t){return e+parseInt(t)}),0),n=t.userData.data;e.add(t),t.position.setZ(a+500*parseInt(n)/2),t.rotateX(a/500%2*Math.PI)}(d,L.tempFloor)}L.intersectObject=t}}},handlePointerUp:function(e){if(!(e.timeStamp-L.pointerDownTime>=120))if(0===e.button){if(C.mode===f)return;L.intersectObject&&(C.playedArea=L.intersectObject.userData.id,C.truePos=T.rotateUp(C.playedCard,L.up),z.changeMode(f))}else 2===e.button&&z.changeMode(b)},handlePointerDown:function(e){L.pointerDownTime=e.timeStamp},createTempFloor:function(){var e;if((null===(e=C.playedCard)||void 0===e?void 0:e.length)||C.playedChess){L.disposeTempFloor();var t=C.playedChess,a=B(t,j);this.tempFloor=a}},disposeTempFloor:function(){L.tempFloor&&(L.tempFloor.parent&&L.tempFloor.parent.remove(L.tempFloor),T.disposeAll(L.tempFloor))},start:function(e,t){L.raycaster=t,e.addEventListener("pointermove",L.handleViewModeMove),e.addEventListener("pointermove",L.handleOperModeMove),e.addEventListener("pointerdown",this.handlePointerDown),e.addEventListener("pointerup",this.handlePointerUp)},play:function(e,t,a,n){var r=[e],o=T.rotateUp(t,n),c=Object(s.a)(o,2),i=c[0],l=c[1],d=C.buildings.find((function(e){return e.userData.id==="".concat(a,"-").concat(i,"-").concat(l)}));M(d,r)},reset:function(){L.pointerDownTime=0,L.intersectObject=null}},z=function(){function e(){Object(d.a)(this,e)}return Object(u.a)(e,[{key:"init",value:function(e){this.renderer=this.initRenderer(e),this.camera=this.initCamera(),this.secondViewCamera=this.initSecondViewCamera(),this.scene=this.initScene(),this.controls=this.initControls(),this.mouse=new h.y,this.raycaster=this.initRaycaster(),this.mode=f,this.initLights(),this.initEvents(),this.initSky(),this.update()}},{key:"initRenderer",value:function(e){var t=document.createElement("canvas");t.style.height="100vh",t.style.width="100vw",e.appendChild(t);var a=new h.A({canvas:t,antialias:!0,autoClear:!1});return a.setPixelRatio(window.devicePixelRatio),a.setSize(window.innerWidth,window.innerHeight),a}},{key:"initCamera",value:function(){var e=new h.p(75,window.innerWidth/window.innerHeight,100,1e6);return window.camera=e,e.up.copy(new h.z(0,0,1)),e.position.setY(-11e3),e.position.setZ(2e3),C.oriViewState.camera={position:(new h.z).copy(e.position),up:new h.z(0,0,1)},e}},{key:"initSecondViewCamera",value:function(){var e=new h.o(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,10,1e6);return e.up.copy(new h.z(0,0,1)),e.position.copy(new h.z(-2e3,0,500)),e.lookAt(new h.z(0,0,0)),e.zoom=.1,e}},{key:"initScene",value:function(){var e=new h.t;return e.background=new h.e("rgb(31,50,104)"),e}},{key:"initControls",value:function(){var e=new p.a(this.camera,this.renderer.domElement);return e.screenSpacePanning=!1,e.enableDamping=!0,e.dampingFactor=.1,e.maxPolarAngle=Math.PI/2,e.target.set(0,0,2e3),C.oriViewState.controls={target:(new h.z).copy(e.target)},e}},{key:"initLights",value:function(){var e=new h.j(new h.e(16242646),new h.e(10923984),.9);e.position.set(0,0,1),this.scene.add(e);var t=new h.f(new h.e(16777215),.25);t.position.copy(new h.z(1,-2,2)),this.scene.add(t);var a=new h.f(new h.e(14935011),.15);a.position.copy(new h.z(-1,2,0)),this.scene.add(a)}},{key:"initSky",value:function(){var e=new h.u(2e4,64,64),t=P,a=new h.l(e,t);a.rotateX(Math.PI/2),this.scene.add(a)}},{key:"initEvents",value:function(){var e=this;window.onresize=function(t){e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.secondViewCamera.left=window.innerWidth/-2,e.secondViewCamera.right=window.innerWidth/2,e.secondViewCamera.top=window.innerHeight/-2,e.secondViewCamera.bottom=window.innerHeight/2,e.renderer.setSize(window.innerWidth,window.innerHeight)},window.onpointermove=function(t){e.mouse.x=t.clientX/window.innerWidth*2-1,e.mouse.y=-t.clientY/window.innerHeight*2+1}}},{key:"initRaycaster",value:function(){var e=new h.s;return e.setFromCamera(this.mouse,this.camera),e}},{key:"setOpt",value:function(e){}},{key:"update",value:function(){var e=this;requestAnimationFrame((function(){return e.update()})),A.b.update(),this.controls.update(),this.raycaster.setFromCamera(this.mouse,this.camera),this.renderer.render(this.scene,this.camera)}},{key:"drawBoard",value:function(e,t){!function(e,t,a){var n=new h.i;n.userData.type=v,e.add(n);var r=new h.a(1e4);n.add(r),window.axesHelper=r;for(var o=0,c=Object.keys(a);o<c.length;o++){var s=c[o],i=a[s],d=new h.i;d.userData.id=s,d.userData.type=w;var u=parseInt(s.replace("area",""));d.position.setX(u%3*3600-3600),d.position.setY(1800-3600*parseInt(u/3)),d.position.setZ(0),d.rotateZ(t/4*Math.PI*2),n.add(d),C.areas.push(d);for(var p=0;p<3;p++)for(var f=0;f<3;f++){var b=Object(l.a)(i[p][f]),j=new h.i;j.userData.id="".concat(s,"-").concat(p,"-").concat(f),j.userData.data=[],j.userData.type=O,d.add(j),C.buildings.push(j);var m=new h.z(1100*f-1100,1100-1100*p,0);j.position.copy(m);var _=new h.i;_.userData.type=y,j.add(_),_.position.setZ(-550);var g=new h.l(new h.q(1e3,1e3),D);g.position.setZ(450),_.add(g);var x=new h.l(new h.q(1e3,1e3),k);x.position.set(0,-500,-50),x.rotateZ(Math.PI),x.rotateX(-Math.PI/2),_.add(x);var I=x.clone();I.position.setY(500),I.rotateY(Math.PI),_.add(I);var N=x.clone();N.position.setY(0),N.position.setX(-500),N.rotateY(Math.PI/2),_.add(N);var S=N.clone();S.position.setX(500),S.rotateY(Math.PI),_.add(S);var P=new h.c(900,900,100),B=new h.l(P,D);_.add(B),B.position.setZ(500),M(j,b)}}}(this.scene,e,t)}},{key:"resetViewState",value:function(){this.camera.position.copy(C.oriViewState.camera.position),this.camera.up.copy(C.oriViewState.camera.up),this.controls.target.copy(C.oriViewState.controls.target)}}],[{key:"changeMode",value:function(e){this.mode=e,C.mode=this.mode,L.reset()}}]),e}(),R=new z;var V="pre_round",H="round_end",W={up:0,userId:"",color:"",step:V,cityData:{},cardData:[],chessData:[],userList:[],leftChessData:{1:11,2:6,3:4,4:3},playedData:{}},X=Object(i.b)({key:"msgListStom",default:[]}),Y=Object(i.b)({key:"played-data-atom",default:W.playedData}),J=a(14),Z=a.n(J),U=a(20),q=a(26),G=a.n(q),K={url:"",key:"",id:"",ws:null,setUrl:function(e){return K.url=e},setKey:function(e){return K.key=e},setId:function(e){return K.id=e},getInitData:function(){var e=Object(U.a)(Z.a.mark((function e(){return Z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G.a.get("".concat(K.url).concat(K.key,"/data?userId=").concat(K.id)).then((function(e){W.cityData=e.data.cityData,W.cardData=e.data.cardData,W.chessData=e.data.chessData,W.up=e.data.up,W.color=e.data.color,W.userId=e.data.userId,W.leftChessData=e.data.leftChessData,W.playedData=e.data.playedData,W.userList=e.data.users.sort((function(e,t){return e.up-t.up})),L.up=W.up})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setWs:function(e){var t=new WebSocket(e);K.ws=t,t.onopen=function(){t.send(JSON.stringify({type:x.setColor,roomKey:K.key,payload:{userId:W.userId}}))};var a=t.onmessage;t.onmessage=function(e){console.log("net.js 44"),a&&a(e),console.log(JSON.parse(e.data))}},postRoundChess:function(){var e=Object(U.a)(Z.a.mark((function e(t){return Z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G.a.post("".concat(K.url).concat(K.key,"/postRoundChess"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),play:function(){var e=Object(U.a)(Z.a.mark((function e(t){return Z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G.a.post("".concat(K.url).concat(K.key,"/play"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),postScore:function(){var e=Object(U.a)(Z.a.mark((function e(t){return Z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",G.a.post("".concat(K.url).concat(K.key,"/score"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Q=a(16),$=a.n(Q),ee=a(6);function te(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)(""),c=Object(s.a)(o,2),d=c[0],u=c[1],h=Object(i.d)(X),p=Object(s.a)(h,2),f=p[0],b=p[1],j=Object(i.e)(Y),m=Object(n.useState)(!0),v=Object(s.a)(m,2),w=v[0],O=v[1],y=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=K.ws.onmessage;K.ws.onmessage=function(t){e(t);var a=JSON.parse(t.data),n=a.type,r=a.payload;n===x.chat&&(b((function(e){return[].concat(Object(l.a)(e),[{color:r.color,value:r.message}])})),u(""))}}),[b]),Object(n.useEffect)((function(){y.current.scrollTop=y.current.scrollHeight}),[f,y]),Object(ee.jsxs)("div",{className:"".concat($.a.chatroom," ").concat($.a[W.color]),children:[Object(ee.jsx)("div",{className:"".concat($.a.symbol," ").concat(a?$.a.spread:""),onClick:function(e){return r(!a)},children:"\ue901"}),Object(ee.jsxs)("div",{children:[Object(ee.jsx)("div",{className:"".concat($.a.popList),ref:y,children:w?f.map((function(e,t){return Object(ee.jsx)("div",{className:"".concat($.a.pop," ").concat($.a[e.color]," ").concat(e.color===W.color?$.a.self:""," ").concat(a?"":$.a.collapse),children:e.value},e.value+t)})):j.map((function(e,t){return Object(ee.jsx)("div",{className:"".concat($.a.pop," ").concat($.a[e.color]," ").concat(e.color===W.color?$.a.self:""," ").concat(a?"":$.a.collapse),children:"".concat(e.floor).concat(e.card).concat(e.area)},t+e.floor)}))}),Object(ee.jsxs)("div",{className:"".concat($.a.inputContainer,"   ").concat(a?"":$.a.collapse),children:[Object(ee.jsx)("div",{className:"".concat($.a.channelTitle),children:w?"\u804a\u5929":"\u8bb0\u5f55"}),Object(ee.jsx)("input",{className:"".concat($.a.input),onChange:function(e){w&&u(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&w&&""!==d?K.ws.send(JSON.stringify({type:x.chat,roomKey:K.key,payload:{userId:W.userId,message:d}})):"Tab"===e.key&&(e.preventDefault(),O(!w))},value:d,placeholder:"\u6309tab\u5207\u6362\u9891\u9053"})]})]})]})}var ae=a(12),ne=a(11),re=a(13),oe=a.n(re);function ce(e,t,a,n,r,o,c){e.beginPath(),e.moveTo(t,a+o),e.lineTo(t,a+r-o),e.arc(t+o,a-o+r,o,Math.PI,Math.PI/2,!0),e.lineTo(t+n-o,a+r),e.arc(t-o+n,a-o+r,o,Math.PI/2,0,!0),e.lineTo(t+n,a+o),e.arc(t-o+n,a+o,o,0,-Math.PI/2,!0),e.lineTo(t+o,a),e.arc(t+o,a+o,o,-Math.PI/2,-Math.PI,!0),e.stroke(),c&&(e.fillStyle="rgba(255,255,255,1)",e.fill())}function se(e){var t=e.idx,a=e.color,r=e.data,o=e.selectedCard,c=e.setSelectedCard,s=e.hoveredCard,l=e.setHoveredCard,d=Object(n.useRef)(null),u=Object(i.e)(ge),h=Object(n.useRef)({green:["#aac9ce","#f3dbcd",g.green],blue:["#c9bbcb","#aac9ce",g.blue],red:["#e5c1cd","#f3dbcf",g.red],yellow:["#f3dbcf","#c9bbcb",g.yellow]});return Object(n.useEffect)((function(){var e=d.current.getContext("2d"),t=e.createLinearGradient(0,0,192,192);t.addColorStop(0,h.current[a][0]),t.addColorStop(1,h.current[a][1]),e.fillStyle=t,e.fillRect(0,0,192,192),e.lineWidth=4,e.strokeStyle="rgba(255,255,255,1)";for(var n=0;n<3;n++)for(var o=0;o<3;o++){var c=!1;r[0]===n&&r[1]===o&&(c=!0),ce(e,44*o+15*(o+1),44*n+15*(n+1),44,44,8,c)}}),[a,r]),Object(ee.jsx)("canvas",{className:"".concat(oe.a.card," ").concat(t===o?oe.a.selected:""," ").concat(t===o+1?oe.a.selectedNext:""," ").concat(t===s?oe.a.hovered:""," ").concat(t===s+1?oe.a.hoveredNext:""),width:192,height:192,style:{left:100*t+"px",borderColor:t===o?h.current[a][2]:"rgba(255,255,255,1)"},onClick:function(e){u.replace("_turn","")===W.color&&c(t)},onPointerEnter:function(e){return l(t)},onPointerLeave:function(e){return l(-2)},ref:d})}var ie=Object(i.b)({key:"_card-data",default:Object(l.a)(W.cardData)}),le=Object(i.c)({key:"card-data",get:function(e){return(0,e.get)(ie)},set:function(e){var t=e.set,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(l.a)(W.cardData);W.cardData=a,t(ie,a)}}),de=Object(i.b)({key:"_round-chess-data",default:Object(l.a)(W.chessData)}),ue=Object(i.c)({key:"round-chess-data",get:function(e){return(0,e.get)(de)},set:function(e){var t=e.set,a=(e.get,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(l.a)(W.chessData));W.chessData=a,t(de,a)}}),he=Object(i.b)({default:W.leftChessData,key:"_left-chess-data"}),pe=Object(i.b)({default:"",key:"temp-msg-atom"});function fe(){var e,t=Object(i.d)(le),a=Object(s.a)(t,2),r=a[0],o=a[1],c=Object(i.d)(ue),d=Object(s.a)(c,2),u=d[0],h=d[1],p=Object(i.d)(he),f=Object(s.a)(p,2),j=f[0],m=f[1],v=Object(n.useState)(-2),w=Object(s.a)(v,2),O=w[0],y=w[1],_=Object(n.useState)(-2),g=Object(s.a)(_,2),x=g[0],D=g[1],k=Object(n.useState)(-2),I=Object(s.a)(k,2),N=I[0],S=I[1],P=Object(n.useState)([]),M=Object(s.a)(P,2),B=M[0],A=M[1],E=Object(n.useState)(!1),T=Object(s.a)(E,2),F=T[0],R=T[1],X=Object(i.d)(pe),Y=Object(s.a)(X,2),J=Y[0],Z=Y[1],U=Object(i.e)(_e),q=Object(i.e)(ge),G=3===Object.keys(W.userList).length?4:6;Object(n.useEffect)((function(){U&&(o(Object(l.a)(W.cardData)),h(Object(l.a)(W.chessData)))}),[U,o,h]),Object(n.useEffect)((function(){u.length&&q!==V&&W.color===q.replace("_turn","")&&(C.playedChess=u[N]+W.color,L.createTempFloor(),z.changeMode(b))}),[N,u,q]),Object(n.useEffect)((function(){r.length&&q!==V&&W.color===q.replace("_turn","")&&(C.playedCard=r[O],L.createTempFloor(),z.changeMode(b))}),[O,r,q]),Object(n.useEffect)((function(){var e="\u8bf7\u9009\u62e9\u672c\u9636\u6bb5\u6e38\u620f\u4f60\u6240\u9009\u7528\u7684\u68cb\u5b50",t="\u4f60\u7684\u56de\u5408\uff0c\u8bf7\u6446\u653e\u5efa\u7b51",a="\u73b0\u5728\u662f\u5176\u4ed6\u4eba\u7684\u56de\u5408",n="\u672c\u9636\u6bb5\u7ed3\u675f\uff0c\u4f60\u7684\u5206\u6570\u662f\uff1a";console.log(q),q===V?Z(e):q.includes("turn")?W.color===q.replace("_turn","")?setTimeout((function(){y(0),S(0),Z(t),R(!1)}),100):setTimeout((function(){Z(a)}),100):q===H&&Z(n)}),[q,Z]);var Q=(e={},Object(ae.a)(e,V,Object(ee.jsx)("div",{className:"".concat(oe.a.submit," ").concat(oe.a[W.color]," ").concat(F?oe.a.pressed:""),onClick:function(){if(!F)if(B.length<G)Z("\u8bf7\u9009\u62e9"+G+"\u4e2a\u68cb\u5b50");else{R(!0);var e=B.map((function(e){return parseInt(e)})).sort(),t={1:0,2:0,3:0,4:0},a=Object(ne.a)({},W.leftChessData);e.forEach((function(e){return t[e]+=1}));for(var n=1;n<5;n++)a[n]=a[n]-t[n];var r={userId:W.userId,roundChess:e,leftChess:a};K.postRoundChess(r).then((function(){h(e),W.leftChessData=Object(ne.a)({},a),m(W.leftChessData),A([]),Z("\u6b63\u5728\u7b49\u5f85\u5176\u4ed6\u73a9\u5bb6"),console.log(W)})).catch((function(){Z("\u7f51\u7edc\u95ee\u9898\uff0c\u8bf7\u91cd\u8bd5"),setTimeout((function(){Z("")}),3e3),R(!1)}))}},children:"\u7ed3\u675f\u51c6\u5907"})),Object(ae.a)(e,"your",Object(ee.jsx)("div",{className:"".concat(oe.a.submit," ").concat(oe.a[W.color]," ").concat(F?oe.a.pressed:""),onClick:function(e){F||function(){var e=u[N]+W.color,t=r[O],a=C.playedArea;if(""===a){var n=J;return Z("\u8bf7\u9009\u62e9\u57ce\u533a"),void setTimeout((function(){Z(n)}),3e3)}var c=Object(s.a)(C.truePos,2),i=c[0],l=c[1],d=JSON.parse(JSON.stringify(W.cityData));d[a][i][l].push(e);var p=W.cardData.filter((function(e,t){return t!==O})),f=W.chessData.filter((function(e,t){return t!==N})),b={userId:W.userId,floor:e,card:t,area:a,leftCard:p,roundChess:f,cityData:d};K.play(b).then((function(e){var t=e.data;L.disposeTempFloor(),o(t),h(f),y(-2),S(-2)}))}()},children:"\u7ed3\u675f\u56de\u5408"})),Object(ae.a)(e,"other",""),e),$=[0,1,2,3,4,5].map((function(e){return Object(ee.jsx)("div",{className:"".concat(oe.a.chess," ").concat(oe.a[W.color]," ").concat(e===N?oe.a.selected:""),onClick:function(t){q.replace("_turn","")===W.color&&u[e]&&S(e)},children:u[e]?Object(ee.jsx)("img",{src:"./floor".concat(u[e],".svg"),alt:"floor".concat(u[e])}):Object(ee.jsx)("div",{className:"".concat(oe.a.chessHolder)})},e)})),te=function(e){return new Array(j[e]).fill().map((function(t,a){return Object(ee.jsx)("div",{className:"".concat(oe.a.chess,"  ").concat(oe.a[W.color]," ").concat(B.includes("".concat(e,"-").concat(a))?oe.a.selected:""),onClick:function(t){if(q===V&&!F)if(B.includes("".concat(e,"-").concat(a)))A(B.filter((function(t){return t!=="".concat(e,"-").concat(a)})));else{if(B.length>=G)return;A([].concat(Object(l.a)(B),["".concat(e,"-").concat(a)]))}},style:{marginLeft:a%6===0?"":".4rem",marginBottom:".4rem"},children:Object(ee.jsx)("img",{src:"./floor".concat(e,".svg"),alt:"floor".concat(e)})},a)}))},re=Object.keys(j).sort().map((function(e){return Object(ee.jsx)("div",{className:"".concat(oe.a.rowChessArea),children:te(e)},e)}));return Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsxs)("div",{className:"".concat(oe.a.btnBars),children:[Object(ee.jsxs)("div",{className:"".concat(oe.a.msg),children:[Object(ee.jsx)("div",{children:J}),Object(ee.jsx)("div",{className:"".concat(oe.a.backView," ").concat(oe.a[W.color]),children:"\ue900"})]}),Object(ee.jsx)("div",{className:"".concat(oe.a.btnArea),children:Q[q]||(q.replace("_turn","")===W.color?Q.your:Q.other)})]}),Object(ee.jsxs)("div",{className:"".concat(oe.a.dash),children:[Object(ee.jsx)("div",{className:"".concat(oe.a.cardArea),children:r.map((function(e,t){return Object(ee.jsx)(se,{idx:t,data:e,color:W.color,selectedCard:O,hoveredCard:x,setSelectedCard:y,setHoveredCard:D},"".concat(t,"-").concat(e))}))}),Object(ee.jsxs)("div",{className:"".concat(oe.a.chessArea),children:[Object(ee.jsx)("div",{className:"".concat(oe.a.roundChessArea),children:$}),Object(ee.jsx)("div",{className:"".concat(oe.a.leftChessArea),children:re})]})]})]})}var be=Object(i.b)({default:W.userList,key:"user-info-atom"}),je=a(18),me=a.n(je);function ve(){var e=Object(i.e)(be),t=Object(i.e)(ge),a=Object(n.useState)({}),r=Object(s.a)(a,2),o=r[0],c=r[1];Object(n.useEffect)((function(){console.log(e)}),[e]),Object(n.useEffect)((function(){if(console.log("info.js 18"),t===H){var e=function(e){console.log(e);var t={red:0,blue:0,green:0,yellow:0},a={height:0,color:""};return Object.keys(e).forEach((function(n){for(var r=e[n],o={red:0,blue:0,green:0,yellow:0},c=function(e){for(var n=function(n){var c="",s=0;if(r[e][n].forEach((function(t,a){var o=[parseInt(t),t.substr(1)],i=o[1];s+=o[0],a===r[e][n].length-1&&(c=i)})),!c)return"continue";s>a.height?(a.height=s,a.color=c):s===a.height&&(a.color=""),o[c]+=1,t[c]+=1},c=0;c<3;++c)n(c)},s=0;s<3;++s)c(s);var i={color:"",num:0};for(var l in o)o[l]>i.num?(i.color=l,i.num=o[l]):o[l]===i.num&&(i.color="");i.color&&(t[i.color]+=3)})),a.color&&(t[a.color]+=5),t}(W.cityData);K.postScore({userId:W.userId,score:e[W.color]}).then((function(){console.log("ok")})),console.log(e)}}),[t]);return Object(ee.jsx)("div",{className:"".concat(me.a.info),children:e.map((function(e){return Object(ee.jsxs)("div",{className:"".concat(me.a[e.color]," ").concat(me.a.userboard),onClick:(a=e.color,function(e){var t=Object(ne.a)({},o);t[a]=!t[a],c(t)}),children:[Object(ee.jsxs)("div",{className:"".concat(me.a.pin),children:[Object(ee.jsx)("div",{className:"".concat(me.a.avatar),children:t.replace("_turn","")===e.color?Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)("div",{className:"".concat(me.a.pointerContainer," ").concat(me.a.long)}),Object(ee.jsx)("div",{className:"".concat(me.a.pointerContainer)})]}):null}),Object(ee.jsx)("div",{className:"".concat(me.a.infoRow),children:"\u4f4d\u7f6e\uff1a".concat(e.up," \u5f97\u5206\uff1a").concat(e.score)})]}),Object(ee.jsx)("div",{className:"".concat(me.a.chess," ").concat(o[e.color]?"":me.a.hide),children:e.chessData.map((function(e,t){return Object(ee.jsx)("img",{src:"./floor".concat(e,".svg"),alt:"floor".concat(e)},t)}))}),Object(ee.jsx)("div",{className:"".concat(me.a.chess," ").concat(o[e.color]?"":me.a.hide),children:Object.keys(e.leftChessData).sort().map((function(t){return Object(ee.jsxs)("div",{className:"".concat(me.a.leftChess),children:[Object(ee.jsx)("img",{src:"./floor".concat(t,".svg"),alt:"floor".concat(t)}),Object(ee.jsx)("div",{children:e.leftChessData[t]})]},t)}))})]},e.color);var a}))})}var we=a(43),Oe=a.n(we);function ye(){var e=Object(n.useRef)(null),t=Object(i.e)(ge),a=Object(i.f)(Y),r=Object(i.f)(be);return Object(n.useEffect)((function(){var t,n,o;t=e.current,n=W.up,o=W.cityData,R.init(t),R.drawBoard(n,o),L.start(t,R.raycaster);var c=K.ws.onmessage;K.ws.onmessage=function(e){console.log("stage.js 20"),c&&c(e);var t=JSON.parse(e.data),n=t.type,o=t.payload;if(n===x.step){if(o.playedData&&(a(o.playedData),W.playedData=o.playedData),o.play){var s=o.play,i=s.floor,l=s.card,d=s.area,u=s.up;L.play(i,l,d,u)}o.cityData&&(W.cityData=o.cityData),o.users&&(W.userList=W.userList.map((function(e,t){var a=o.users.find((function(t){return t.color===e.color}));return Object(ne.a)(Object(ne.a)({},e),a)})),r(W.userList))}}}),[a,r]),Object(n.useEffect)((function(){t.replace("_turn","")===W.color?z.changeMode(b):z.changeMode(f)}),[t]),Object(ee.jsx)("div",{ref:e,className:"".concat(Oe.a.stage)})}var _e=Object(i.b)({default:!1,key:"ready-atom"}),ge=Object(i.b)({key:"step-atom",default:W.step});var xe=function(){var e=Object(i.d)(_e),t=Object(s.a)(e,2),a=t[0],r=t[1],o=Object(i.f)(ge),c=Object(i.f)(pe),l=Object(i.f)(Y),d=Object(i.f)(be),u=Object(i.f)(he);return Object(n.useEffect)((function(){var e=window.location.pathname.split("/")[1],t=window.location.search.split("=")[1];K.setUrl("http://127.0.0.1:9000/"),K.setKey(e),K.setId(t),K.getInitData().then((function(){r(!0),K.setWs("ws://127.0.0.1:9000/"),l(W.playedData),d(W.userList),u(W.leftChessData)})).then((function(e){var t=K.ws.onmessage;K.ws.onmessage=function(e){console.log("app.js 42"),t(e);var a=JSON.parse(e.data),n=a.type,r=a.payload;n===x.step&&(o(r.step),W.step=r.step)}}))}),[r,o,c,d,l,u]),Object(ee.jsx)("div",{className:"App",children:a?Object(ee.jsxs)(ee.Fragment,{children:[Object(ee.jsx)(te,{}),Object(ee.jsx)(fe,{}),Object(ee.jsx)(ve,{}),Object(ee.jsx)(ye,{})]}):null})};c.a.render(Object(ee.jsx)(r.a.StrictMode,{children:Object(ee.jsx)(i.a,{children:Object(ee.jsx)(xe,{})})}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.c1f4831a.chunk.js.map